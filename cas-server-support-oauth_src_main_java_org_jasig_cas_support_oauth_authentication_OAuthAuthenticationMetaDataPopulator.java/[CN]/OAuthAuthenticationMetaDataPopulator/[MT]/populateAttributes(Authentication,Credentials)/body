{
  if (credentials instanceof OAuthCredentials) {
    OAuthCredentials oauthCredentials=(OAuthCredentials)credentials;
    final Principal simplePrincipal=new SimplePrincipal(authentication.getPrincipal().getId(),oauthCredentials.getUserProfile().getAttributes());
    final MutableAuthentication mutableAuthentication=new MutableAuthentication(simplePrincipal,authentication.getAuthenticatedDate());
    mutableAuthentication.getAttributes().putAll(authentication.getAttributes());
    mutableAuthentication.getAttributes().put(PROVIDER_TYPE,oauthCredentials.getProviderType());
    return mutableAuthentication;
  }
  return authentication;
}
