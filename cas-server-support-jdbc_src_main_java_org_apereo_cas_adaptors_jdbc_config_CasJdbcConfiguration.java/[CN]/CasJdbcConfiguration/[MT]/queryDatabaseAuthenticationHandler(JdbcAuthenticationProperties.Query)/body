{
  final QueryDatabaseAuthenticationHandler h=new QueryDatabaseAuthenticationHandler();
  h.setDataSource(Beans.newHickariDataSource(b));
  h.setSql(b.getSql());
  h.setPasswordEncoder(Beans.newPasswordEncoder(b.getPasswordEncoder()));
  if (queryPasswordPolicyConfiguration != null) {
    h.setPasswordPolicyConfiguration(queryPasswordPolicyConfiguration);
  }
  if (queryPrincipalNameTransformer != null) {
    h.setPrincipalNameTransformer(queryPrincipalNameTransformer);
  }
  h.setPrincipalFactory(jdbcPrincipalFactory());
  h.setServicesManager(servicesManager);
  return h;
}
