{
  final HttpServletRequest request=WebUtils.getHttpServletRequest(requestContext);
  final String entityId=request.getParameter(this.entityIdParameterName);
  if (StringUtils.isBlank(entityId)) {
    logger.debug("No entity id found for parameter [{}]",this.entityIdParameterName);
    return new EventFactorySupport().success(this);
  }
  if (shouldRefreshMetadata()) {
    buildMetadataResolver();
  }
  final EntityDescriptor entityDescriptor=getEntityDescriptorForEntityId(entityId);
  if (entityDescriptor == null) {
    logger.debug("Entity descriptor not found for [{}]",entityId);
    return new EventFactorySupport().success(this);
  }
  final SPSSODescriptor spssoDescriptor=getSPSSODescriptor(entityDescriptor);
  if (spssoDescriptor == null) {
    logger.debug("SP SSO descriptor not found for [{}]",entityId);
    return new EventFactorySupport().success(this);
  }
  final Extensions extensions=spssoDescriptor.getExtensions();
  final List<XMLObject> spExtensions=extensions.getUnknownXMLObjects(UIInfo.DEFAULT_ELEMENT_NAME);
  if (spExtensions.isEmpty()) {
    logger.debug("No extensions are found for [{}]",UIInfo.DEFAULT_ELEMENT_NAME.getNamespaceURI());
    return new EventFactorySupport().success(this);
  }
  for (  final XMLObject obj : spExtensions) {
    if (obj instanceof UIInfo) {
      final UIInfo uiInfo=(UIInfo)obj;
      logger.debug("Found UI info for [{}]",entityId);
      requestContext.getFlowScope().put(MDUI_FLOW_PARAMETER_NAME,uiInfo);
    }
  }
  return new EventFactorySupport().success(this);
}
