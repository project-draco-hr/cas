{
  final String id=String.valueOf(Math.abs(new SecureRandom().nextLong()));
  Response samlResponse=newResponse(id,new DateTime(),authnRequest.getID(),null);
  samlResponse.setVersion(SAMLVersion.VERSION_20);
  samlResponse.setIssuer(buildEntityIssuer());
  samlResponse.getAssertions().add(assertion);
  final Status status=newStatus(StatusCode.SUCCESS,StatusCode.SUCCESS);
  samlResponse.setStatus(status);
  if (service.isSignResponses()) {
    samlResponse=samlObjectSigner.encode(samlResponse,service,adaptor,response,request);
  }
  return samlResponse;
}
