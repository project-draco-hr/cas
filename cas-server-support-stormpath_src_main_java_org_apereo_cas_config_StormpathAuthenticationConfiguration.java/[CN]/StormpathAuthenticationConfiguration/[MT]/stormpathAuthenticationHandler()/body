{
  final StormpathAuthenticationHandler handler=new StormpathAuthenticationHandler(casProperties.getAuthn().getStormpath().getApiKey(),casProperties.getAuthn().getStormpath().getApplicationId(),casProperties.getAuthn().getStormpath().getSecretkey());
  if (this.passwordEncoder != null) {
    handler.setPasswordEncoder(this.passwordEncoder);
  }
  if (this.principalNameTransformer != null) {
    handler.setPrincipalNameTransformer(this.principalNameTransformer);
  }
  handler.setStormpathPasswordEncoder(this.stormpathPasswordEncoder);
  handler.setPrincipalFactory(stormpathPrincipalFactory());
  handler.setServicesManager(servicesManager);
  return handler;
}
