{
  final String serviceUrl=getServiceUrl();
  final String encodedService=URLEncoder.encode(serviceUrl,"UTF-8");
  beginAt("/login?service=" + encodedService);
  assertFormElementPresent(LOGIN_TOKEN);
  setFormElement("username",getUsername());
  setFormElement("password",getGoodPassword());
  submit();
  final String firstServiceTicket=LoginHelper.serviceTicketFromResponse(getDialog().getResponse());
  assertNotNull(firstServiceTicket);
  beginAt("/serviceValidate?service=" + encodedService + "&ticket="+ firstServiceTicket);
  assertTextPresent("<cas:authenticationSuccess");
  beginAt("/login?service=" + encodedService);
  final String secondServiceTicket=LoginHelper.serviceTicketFromResponse(getDialog().getResponse());
  assertNotNull(secondServiceTicket);
  assertFalse(firstServiceTicket.equals(secondServiceTicket));
  beginAt("/logout");
  beginAt("/login?service=" + encodedService);
  assertFormElementPresent(LOGIN_TOKEN);
  beginAt("/serviceValidate?service=" + encodedService + "&ticket="+ secondServiceTicket);
  assertTextPresent("<cas:authenticationFailure");
}
