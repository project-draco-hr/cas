{
  final AccessToken accessToken=generateAccessToken(service,authentication);
  logger.debug("Generated Oauth access token: {}",accessToken);
  String callbackUrl=redirectUri;
  callbackUrl+="#access_token=" + accessToken.getId() + "&token_type=bearer&expires_in="+ timeout;
  if (state != null) {
    callbackUrl+="&state=" + EncodingUtils.urlEncode(state);
  }
  return callbackUrl;
}
