{
  final Lock lock=entityManager.find(Lock.class,applicationId,LockModeType.PESSIMISTIC_WRITE);
  if (lock == null) {
    return;
  }
  final String owner=lock.getUniqueId();
  if (uniqueId.equals(owner)) {
    lock.setUniqueId(null);
    lock.setExpirationDate(null);
    logger.debug("Releasing {} lock held by {}.",applicationId,uniqueId);
    entityManager.persist(lock);
  }
 else {
    throw new IllegalStateException("Cannot release lock owned by " + owner);
  }
}
