{
  lock.setUniqueId(uniqueId);
  if (lockTimeout > 0) {
    final Calendar cal=Calendar.getInstance();
    cal.add(Calendar.SECOND,lockTimeout);
    lock.setExpirationDate(cal.getTime());
  }
 else {
    lock.setExpirationDate(null);
  }
  boolean success=false;
  try {
    if (lock.getApplicationId() != null) {
      em.merge(lock);
    }
 else {
      lock.setApplicationId(applicationId);
      em.persist(lock);
    }
    success=true;
  }
 catch (  final PersistenceException e) {
    success=false;
    if (log.isDebugEnabled()) {
      log.debug("{} could not obtain {} lock.",new Object[]{uniqueId,applicationId,e});
    }
 else {
      log.info("{} could not obtain {} lock.",uniqueId,applicationId);
    }
  }
  return success;
}
