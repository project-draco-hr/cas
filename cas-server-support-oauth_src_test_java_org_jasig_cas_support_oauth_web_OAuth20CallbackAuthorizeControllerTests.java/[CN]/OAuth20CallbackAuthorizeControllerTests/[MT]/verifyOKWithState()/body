{
  final MockHttpServletRequest mockRequest=new MockHttpServletRequest("GET",CONTEXT + OAuthConstants.CALLBACK_AUTHORIZE_URL);
  mockRequest.addParameter(OAuthConstants.TICKET,SERVICE_TICKET);
  final MockHttpSession mockSession=new MockHttpSession();
  mockSession.putValue(OAuthConstants.OAUTH20_CALLBACKURL,REDIRECT_URI);
  mockSession.putValue(OAuthConstants.OAUTH20_SERVICE_NAME,SERVICE_NAME);
  mockSession.putValue(OAuthConstants.OAUTH20_STATE,STATE);
  mockRequest.setSession(mockSession);
  final MockHttpServletResponse mockResponse=new MockHttpServletResponse();
  final OAuth20WrapperController oauth20WrapperController=new OAuth20WrapperController();
  final ModelAndView modelAndView=oauth20WrapperController.handleRequest(mockRequest,mockResponse);
  assertEquals(OAuthConstants.CONFIRM_VIEW,modelAndView.getViewName());
  final Map<String,Object> map=modelAndView.getModel();
  assertEquals(SERVICE_NAME,map.get("serviceName"));
  assertEquals(REDIRECT_URI + "?" + OAuthConstants.CODE+ "="+ SERVICE_TICKET+ "&"+ OAuthConstants.STATE+ "="+ STATE,map.get("callbackUrl"));
}
