{
  final HttpBasedServiceCredentials serviceCredentials=(HttpBasedServiceCredentials)credentials;
  final String proxyIou=this.uniqueTicketIdGenerator.getNewTicketId(PGTIOU_PREFIX);
  final String serviceCredentialsAsString=serviceCredentials.getCallbackUrl().toExternalForm();
  final StringBuilder stringBuffer=new StringBuilder(serviceCredentialsAsString.length() + proxyIou.length() + proxyGrantingTicketId.length()+ 15);
  stringBuffer.append(serviceCredentialsAsString);
  if (serviceCredentials.getCallbackUrl().getQuery() != null) {
    stringBuffer.append("&");
  }
 else {
    stringBuffer.append("?");
  }
  stringBuffer.append("pgtIou=");
  stringBuffer.append(proxyIou);
  stringBuffer.append("&pgtId=");
  stringBuffer.append(proxyGrantingTicketId);
  if (this.httpClient.isValidEndPoint(stringBuffer.toString())) {
    logger.debug("Sent ProxyIou of {} for service: {}",proxyIou,serviceCredentials.toString());
    return proxyIou;
  }
  logger.debug("Failed to send ProxyIou of {} for service: {}",proxyIou,serviceCredentials.toString());
  return null;
}
