{
  final Authentication authentication=new OAuthAuthentication(ZonedDateTime.now(),principal);
  final Service service=new OAuthWebApplicationService("" + registeredService.getId(),registeredService.getServiceId());
  final OAuthCodeImpl code=(OAuthCodeImpl)oAuthCodeFactory.create(service,authentication);
  oAuth20AccessTokenController.getTicketRegistry().addTicket(code);
  return code;
}
