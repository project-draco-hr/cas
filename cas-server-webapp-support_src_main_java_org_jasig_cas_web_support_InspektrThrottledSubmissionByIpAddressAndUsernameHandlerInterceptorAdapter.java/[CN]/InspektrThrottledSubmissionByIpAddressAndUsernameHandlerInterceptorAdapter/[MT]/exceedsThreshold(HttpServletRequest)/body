{
  final String query="SELECT AUD_DATE FROM COM_AUDIT_TRAIL WHERE AUD_CLIENT_IP = ? AND AUD_USER = ? " + "AND AUD_ACTION = ? AND APPLIC_CD = ? AND AUD_DATE >= ? ORDER BY AUD_DATE DESC";
  final String userToUse=constructUsername(request,getUsernameParameter());
  final Calendar cutoff=Calendar.getInstance();
  cutoff.add(Calendar.SECOND,-1 * getFailureRangeInSeconds());
  final List<Timestamp> failures=this.jdbcTemplate.query(query,new Object[]{request.getRemoteAddr(),userToUse,this.authenticationFailureCode,this.applicationCode,cutoff.getTime()},new int[]{Types.VARCHAR,Types.VARCHAR,Types.VARCHAR,Types.VARCHAR,Types.TIMESTAMP},new RowMapper<Timestamp>(){
    @Override public Timestamp mapRow(    final ResultSet resultSet,    final int i) throws SQLException {
      return resultSet.getTimestamp(1);
    }
  }
);
  if (failures.size() < 2) {
    return false;
  }
  return NUMBER_OF_MILLISECONDS_IN_SECOND / (failures.get(0).getTime() - failures.get(1).getTime()) > getThresholdRate();
}
