{
  final String relayState=request.getParameter(SamlProtocolConstants.PARAMETER_SAML_RELAY_STATE);
  final String xmlRequest=BUILDER.decodeSamlAuthnRequest(request.getParameter(SamlProtocolConstants.PARAMETER_SAML_REQUEST));
  if (!StringUtils.hasText(xmlRequest)) {
    return null;
  }
  final Document document=AbstractSaml20ObjectBuilder.constructDocumentFromXml(xmlRequest);
  if (document == null) {
    return null;
  }
  final Element root=document.getRootElement();
  final String assertionConsumerServiceUrl=root.getAttributeValue("AssertionConsumerServiceURL");
  final String requestId=root.getAttributeValue("ID");
  return new GoogleAccountsService(assertionConsumerServiceUrl,relayState,requestId,privateKey,publicKey,servicesManager);
}
