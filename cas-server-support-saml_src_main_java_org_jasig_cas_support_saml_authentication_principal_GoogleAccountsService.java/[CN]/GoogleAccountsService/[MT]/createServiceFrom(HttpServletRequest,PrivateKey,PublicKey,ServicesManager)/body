{
  final String relayState=request.getParameter(CONST_RELAY_STATE);
  final String xmlRequest=decodeAuthnRequestXML(request.getParameter(CONST_PARAM_SERVICE));
  if (!StringUtils.hasText(xmlRequest)) {
    return null;
  }
  final Document document=SamlUtils.constructDocumentFromXmlString(xmlRequest);
  if (document == null) {
    return null;
  }
  final String assertionConsumerServiceUrl=document.getRootElement().getAttributeValue("AssertionConsumerServiceURL");
  final String requestId=document.getRootElement().getAttributeValue("ID");
  return new GoogleAccountsService(assertionConsumerServiceUrl,relayState,requestId,privateKey,publicKey,servicesManager);
}
