{
  final OAuthCode code=this.oAuthCodeFactory.create(service,authentication);
  logger.debug("Generated OAuth code: {}",code);
  this.ticketRegistry.addTicket(code);
  String callbackUrl=redirectUri;
  callbackUrl=CommonHelper.addParameter(callbackUrl,OAuthConstants.CODE,code.getId());
  if (state != null) {
    callbackUrl=CommonHelper.addParameter(callbackUrl,OAuthConstants.STATE,state);
  }
  return callbackUrl;
}
