{
  Service service=TestUtils.getService("testAnonymous");
  UsernamePasswordCredential cred=TestUtils.getCredentialsWithSameUsernameAndPassword();
  final String ticketGrantingTicket=getCentralAuthenticationService().createTicketGrantingTicket(cred);
  final String serviceTicket=getCentralAuthenticationService().grantServiceTicket(ticketGrantingTicket,service);
  final Assertion assertion=getCentralAuthenticationService().validateServiceTicket(serviceTicket,service);
  final Authentication auth=assertion.getPrimaryAuthentication();
  assertNotEquals(cred.getUsername(),auth.getPrincipal().getId());
}
