{
  final Service service=TestUtils.getService("eduPersonTestInvalid");
  final UsernamePasswordCredential cred=TestUtils.getCredentialsWithSameUsernameAndPassword();
  final TicketGrantingTicket ticketGrantingTicket=getCentralAuthenticationService().createTicketGrantingTicket(cred);
  final ServiceTicket serviceTicket=getCentralAuthenticationService().grantServiceTicket(ticketGrantingTicket.getId(),service);
  final Assertion assertion=getCentralAuthenticationService().validateServiceTicket(serviceTicket.getId(),service);
  final Authentication auth=assertion.getPrimaryAuthentication();
  final Map<String,Object> attributes=auth.getPrincipal().getAttributes();
  assertEquals(1,attributes.size());
  assertEquals("adopters",attributes.get("groupMembership"));
}
