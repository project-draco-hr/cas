{
  openIdService=OpenIdService.createServiceFrom(request);
  when(context.getBean("serverManager")).thenReturn(manager);
  when(context.getBean("centralAuthenticationService")).thenReturn(cas);
  final Response response=this.openIdService.getResponse("test");
  try {
    verify(cas,never()).validateServiceTicket("test",openIdService);
  }
 catch (  final Exception e) {
    LOGGER.debug("Exception during verification of service ticket",e);
  }
  assertNotNull(response);
  assertEquals("test",response.getAttributes().get("openid.assoc_handle"));
  assertEquals("http://www.ja-sig.org/?service=fa",response.getAttributes().get("openid.return_to"));
  assertEquals("http://openid.ja-sig.org/battags",response.getAttributes().get("openid.identity"));
  final Response response2=this.openIdService.getResponse(null);
  assertEquals("cancel",response2.getAttributes().get("openid.mode"));
}
