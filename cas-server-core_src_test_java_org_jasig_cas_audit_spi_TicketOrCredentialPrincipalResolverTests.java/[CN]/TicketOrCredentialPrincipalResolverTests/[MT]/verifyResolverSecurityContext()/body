{
  final UserDetails ud=mock(UserDetails.class);
  when(ud.getUsername()).thenReturn("pid");
  final Authentication authn=mock(Authentication.class);
  when(authn.getPrincipal()).thenReturn(ud);
  final SecurityContext securityContext=mock(SecurityContext.class);
  when(securityContext.getAuthentication()).thenReturn(authn);
  SecurityContextHolder.setContext(securityContext);
  final TicketOrCredentialPrincipalResolver res=new TicketOrCredentialPrincipalResolver(getCentralAuthenticationService());
  final JoinPoint jp=mock(JoinPoint.class);
  when(jp.getArgs()).thenReturn(new Object[]{ud});
  final String result=res.resolveFrom(jp,null);
  assertNotNull(result);
  assertEquals(result,ud.getUsername());
}
