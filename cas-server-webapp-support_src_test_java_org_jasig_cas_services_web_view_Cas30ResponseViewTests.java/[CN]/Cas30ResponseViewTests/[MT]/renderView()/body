{
  final ModelAndView modelAndView=this.getModelAndViewUponServiceValidationWithSecurePgtUrl();
  final JstlView v=(JstlView)resolver.resolveViewName(modelAndView.getViewName(),Locale.getDefault());
  final MockHttpServletRequest req=new MockHttpServletRequest(new MockServletContext());
  v.setServletContext(req.getServletContext());
  req.setAttribute(RequestContext.WEB_APPLICATION_CONTEXT_ATTRIBUTE,new GenericWebApplicationContext(req.getServletContext()));
  final Cas30ResponseView view=new Cas30ResponseView(v);
  view.setServicesManager(this.servicesManager);
  view.setCasAttributeEncoder(new DefaultCasAttributeEncoder(this.servicesManager));
  final MockHttpServletResponse resp=new MockHttpServletResponse();
  view.render(modelAndView.getModel(),req,resp);
  return (Map<?,?>)req.getAttribute(CasProtocolConstants.VALIDATION_CAS_MODEL_ATTRIBUTE_NAME_ATTRIBUTES);
}
