{
  final Principal principal;
  final HandlerResult result=handler.authenticate(credential);
  builder.addSuccess(handler.getName(),result);
  logger.info("{} successfully authenticated {}",handler.getName(),credential);
  if (resolver == null) {
    principal=result.getPrincipal();
    logger.debug("No resolver configured for {}. Falling back to handler principal {}",handler.getName(),principal);
  }
 else {
    principal=resolvePrincipal(handler.getName(),resolver,credential);
  }
  if (principal != null) {
    builder.setPrincipal(principal);
  }
}
