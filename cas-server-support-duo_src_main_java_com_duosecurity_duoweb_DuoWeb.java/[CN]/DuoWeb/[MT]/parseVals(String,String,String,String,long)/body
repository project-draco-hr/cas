{
  final String[] parts=val.split("\\|");
  if (parts.length != 3) {
    throw new DuoWebException("Invalid response");
  }
  final String u_prefix=parts[0];
  final String u_b64=parts[1];
  final String u_sig=parts[2];
  final String sig=Util.hmacSign(key,u_prefix + '|' + u_b64);
  if (!Util.hmacSign(key,sig).equals(Util.hmacSign(key,u_sig))) {
    throw new DuoWebException("Invalid response");
  }
  if (!u_prefix.equals(prefix)) {
    throw new DuoWebException("Invalid response");
  }
  final byte[] decoded=Base64.decode(u_b64);
  final String cookie=new String(decoded);
  final String[] cookie_parts=cookie.split("\\|");
  if (cookie_parts.length != 3) {
    throw new DuoWebException("Invalid response");
  }
  final String username=cookie_parts[0];
  final String u_ikey=cookie_parts[1];
  final String expire=cookie_parts[2];
  if (!u_ikey.equals(ikey)) {
    throw new DuoWebException("Invalid response");
  }
  final long expire_ts=Long.parseLong(expire);
  if (time >= expire_ts) {
    throw new DuoWebException("Transaction has expired. Please check that the system time is correct.");
  }
  return username;
}
