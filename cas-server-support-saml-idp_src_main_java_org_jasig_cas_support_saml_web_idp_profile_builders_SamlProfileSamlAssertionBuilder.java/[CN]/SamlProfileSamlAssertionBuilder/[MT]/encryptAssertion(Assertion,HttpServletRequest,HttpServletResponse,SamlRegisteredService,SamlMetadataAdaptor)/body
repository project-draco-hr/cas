{
  try {
    if (service.isEncryptAssertions()) {
      logger.info("SAML service [{}] requires assertions to be encrypted",adaptor.getEntityId());
      this.samlObjectEncrypter.encode(assertion,service,adaptor,response,request);
    }
 else {
      logger.info("SAML registered service [{}] does not require assertions to be encrypted",adaptor.getEntityId());
    }
  }
 catch (  final Exception e) {
    throw new SamlException("Unable to marshall assertion for encryption",e);
  }
}
