{
  try {
    final DuoCredential duoCredential=(DuoCredential)credential;
    final String duoVerifyResponse=this.duoAuthenticationService.authenticate(duoCredential.getSignedDuoResponse());
    logger.debug("Response from Duo verify: [{}]",duoVerifyResponse);
    final String primaryCredentialsUsername=duoCredential.getUsername();
    final boolean isGoodAuthentication=duoVerifyResponse.equals(primaryCredentialsUsername);
    if (isGoodAuthentication) {
      logger.info("Successful Duo authentication for [{}]",primaryCredentialsUsername);
      final Principal principal=this.principalFactory.createPrincipal(primaryCredentialsUsername);
      return createHandlerResult(credential,principal,new ArrayList<MessageDescriptor>());
    }
    throw new FailedLoginException("Duo authentication error for username " + primaryCredentialsUsername + " and Duo response: "+ duoVerifyResponse);
  }
 catch (  final Exception e) {
    logger.error(e.getMessage(),e);
    throw new FailedLoginException(e.getMessage());
  }
}
