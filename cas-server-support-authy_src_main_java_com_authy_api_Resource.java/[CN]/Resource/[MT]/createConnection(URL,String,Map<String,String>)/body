{
  HttpURLConnection connection=null;
  if (testFlag)   connection=(HttpURLConnection)url.openConnection();
 else   connection=(HttpsURLConnection)url.openConnection();
  connection.setRequestMethod(method);
  for (  Entry<String,String> s : options.entrySet()) {
    connection.setRequestProperty(s.getKey(),s.getValue());
  }
  connection.setDoOutput(true);
  return connection;
}
