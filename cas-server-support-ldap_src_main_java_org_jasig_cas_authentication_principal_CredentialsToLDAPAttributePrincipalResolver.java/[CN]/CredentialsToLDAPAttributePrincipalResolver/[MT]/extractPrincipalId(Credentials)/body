{
  final Principal principal=this.credentialsToPrincipalResolver.resolvePrincipal(credentials);
  if (principal == null) {
    log.info("Initial principal could not be resolved from request, " + "returning null");
    return null;
  }
  log.debug("Resolved {}. Trying LDAP resolve now...",principal);
  final String ldapPrincipal=resolveFromLDAP(principal.getId());
  if (ldapPrincipal == null) {
    log.info("Initial principal {} was not found in LDAP, returning null",principal.getId());
  }
 else {
    log.debug("Resolved {} to {}",principal,ldapPrincipal);
  }
  return ldapPrincipal;
}
