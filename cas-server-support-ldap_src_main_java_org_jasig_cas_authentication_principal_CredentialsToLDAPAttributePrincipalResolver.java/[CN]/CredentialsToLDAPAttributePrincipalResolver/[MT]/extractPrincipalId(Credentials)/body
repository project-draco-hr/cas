{
  final Principal principal=this.credentialsToPrincipalResolver.resolvePrincipal(credentials);
  if (principal == null) {
    log.info("Initial principal could not be resolved from request, " + "returning null");
    return null;
  }
  if (log.isDebugEnabled()) {
    log.debug("Resolved " + principal + ". Trying LDAP resolve now...");
  }
  final String ldapPrincipal=resolveFromLDAP(principal.getId());
  if (ldapPrincipal == null) {
    log.info("Initial principal \"" + principal.getId() + "\" was not found in LDAP, returning null");
  }
 else {
    log.debug("Resolved " + principal + " to "+ ldapPrincipal);
  }
  return ldapPrincipal;
}
