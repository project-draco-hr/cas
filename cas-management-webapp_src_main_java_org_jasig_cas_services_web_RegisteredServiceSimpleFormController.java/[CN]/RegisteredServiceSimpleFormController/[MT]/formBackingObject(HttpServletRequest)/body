{
  final String id=request.getParameter("id");
  if (!StringUtils.hasText(id)) {
    final Object service;
    if (this.getCommandClass() != null) {
      service=this.createCommand();
    }
 else {
      service=new RegisteredServiceImpl();
    }
    logger.debug("Created new service of type " + service.getClass().getName());
    return service;
  }
  final RegisteredService service=this.servicesManager.findServiceBy(Long.parseLong(id));
  if (service != null) {
    setCommandClass(service.getClass());
    logger.debug("Loaded service " + service.getServiceId() + " with command class set to "+ this.getCommandClass());
  }
 else {
    logger.debug("Invalid service id specified.");
  }
  return service;
}
