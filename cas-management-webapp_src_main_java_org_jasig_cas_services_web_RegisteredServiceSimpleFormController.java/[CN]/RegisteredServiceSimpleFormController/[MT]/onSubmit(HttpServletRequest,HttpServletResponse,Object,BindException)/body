{
  RegisteredService service=(RegisteredService)command;
  if (service.getServiceId().startsWith("^") && service instanceof RegisteredServiceImpl) {
    logger.debug("Detected regular expression starting with ^");
    final RegexRegisteredService regexService=new RegexRegisteredService();
    regexService.copyFrom(service);
    service=regexService;
  }
 else   if (!service.getServiceId().startsWith("^") && service instanceof RegexRegisteredService) {
    logger.debug("Detected ant expression " + service.getServiceId());
    final RegisteredServiceImpl regexService=new RegisteredServiceImpl();
    regexService.copyFrom(service);
    service=regexService;
  }
  this.servicesManager.save(service);
  logger.info("Saved changes to service " + service.getId());
  final ModelAndView modelAndView=new ModelAndView(new RedirectView("manage.html#" + service.getId(),true));
  modelAndView.addObject("action","add");
  modelAndView.addObject("id",service.getId());
  return modelAndView;
}
