{
  final Object arg1=joinPoint.getArgs()[0];
  if (arg1 instanceof Credential) {
    return arg1.toString();
  }
 else   if (arg1 instanceof String) {
    final Ticket ticket=this.ticketRegistry.getTicket((String)arg1);
    if (ticket instanceof ServiceTicket) {
      final ServiceTicket serviceTicket=(ServiceTicket)ticket;
      return serviceTicket.getGrantingTicket().getAuthentication().getPrincipal().getId();
    }
 else     if (ticket instanceof TicketGrantingTicket) {
      final TicketGrantingTicket tgt=(TicketGrantingTicket)ticket;
      return tgt.getAuthentication().getPrincipal().getId();
    }
  }
 else {
    final SecurityContext securityContext=SecurityContextHolder.getContext();
    if (securityContext != null) {
      final Authentication authentication=securityContext.getAuthentication();
      if (authentication != null) {
        return ((UserDetails)authentication.getPrincipal()).getUsername();
      }
    }
  }
  return UNKNOWN_USER;
}
