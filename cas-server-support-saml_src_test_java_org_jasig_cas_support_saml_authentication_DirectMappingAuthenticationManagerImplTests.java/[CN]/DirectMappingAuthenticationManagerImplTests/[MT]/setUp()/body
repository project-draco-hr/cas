{
  this.manager=new DirectMappingAuthenticationManagerImpl();
  final Map<Class<? extends Credentials>,DirectAuthenticationHandlerMappingHolder> mappings=new HashMap<Class<? extends Credentials>,DirectAuthenticationHandlerMappingHolder>();
  final List<AuthenticationMetaDataPopulator> populators=new ArrayList<AuthenticationMetaDataPopulator>();
  populators.add(new SamlAuthenticationMetaDataPopulator());
  this.manager.setAuthenticationMetaDataPopulators(populators);
  final DirectAuthenticationHandlerMappingHolder d=new DirectAuthenticationHandlerMappingHolder();
  d.setAuthenticationHandler(new SimpleTestUsernamePasswordAuthenticationHandler());
  d.setCredentialsToPrincipalResolver(new UsernamePasswordCredentialsToPrincipalResolver());
  mappings.put(UsernamePasswordCredentials.class,d);
  this.manager.setCredentialsMapping(mappings);
  super.setUp();
}
