{
  String serviceTicket;
  final String queryString=webResponse.getURL().getQuery();
  final int ticketIndex=queryString.indexOf("ticket=");
  if (ticketIndex == -1) {
    final String response=webResponse.getText();
    final int declarationStartsAt=response.indexOf("window.location.href");
    final String responseAfterWindowLocHref=response.substring(declarationStartsAt + "window.location.href12".length());
    final int endDoubleQuoteIndex=responseAfterWindowLocHref.indexOf("\"");
    final int endSingleQuoteIndex=responseAfterWindowLocHref.indexOf("\'");
    int endQuoteIndex=0;
    if (endDoubleQuoteIndex == -1 && endSingleQuoteIndex == -1) {
      throw new RuntimeException("Failed parsing a service ticket from the response:" + response);
    }
 else     if (endDoubleQuoteIndex > -1 && (endDoubleQuoteIndex < endSingleQuoteIndex || endSingleQuoteIndex == -1)) {
      endQuoteIndex=endDoubleQuoteIndex;
    }
 else {
      endQuoteIndex=endSingleQuoteIndex;
    }
    final int ticketEqualsIndex=responseAfterWindowLocHref.indexOf("ticket=");
    serviceTicket=responseAfterWindowLocHref.substring(ticketEqualsIndex + "ticket=".length(),endQuoteIndex);
  }
 else {
    serviceTicket=queryString.substring(ticketIndex + "ticket=".length(),queryString.length());
  }
  return serviceTicket;
}
