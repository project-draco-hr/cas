{
  final RegisteredService mockRegSvc=mock(RegisteredService.class);
  final RegisteredServiceAuthorizationStrategy authz=mock(RegisteredServiceAuthorizationStrategy.class);
  when(authz.isServiceAuthorized(any(Service.class))).thenReturn(enabled);
  when(mockRegSvc.getServiceId()).thenReturn(svcId);
  when(mockRegSvc.getProxyPolicy()).thenReturn(proxy);
  when(mockRegSvc.getName()).thenReturn(svcId);
  when(mockRegSvc.matches(argThat(new VerifyServiceByIdMatcher(svcId)))).thenReturn(true);
  when(mockRegSvc.getUsernameAttributeProvider()).thenReturn(new DefaultRegisteredServiceUsernameProvider());
  when(mockRegSvc.getAuthorizationStrategy()).thenReturn(authz);
  return mockRegSvc;
}
