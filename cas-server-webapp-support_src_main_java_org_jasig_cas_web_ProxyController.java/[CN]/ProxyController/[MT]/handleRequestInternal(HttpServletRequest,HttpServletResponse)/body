{
  final String ticket=request.getParameter(CasProtocolConstants.PARAMETER_PROXY_GRANTINOG_TICKET);
  final Service targetService=getTargetService(request);
  if (!StringUtils.hasText(ticket) || targetService == null) {
    return generateErrorView(CasProtocolConstants.ERROR_CODE_INVALID_REQUEST,CasProtocolConstants.ERROR_CODE_INVALID_REQUEST_PROXY,null,request);
  }
  try {
    return new ModelAndView(CONST_PROXY_SUCCESS,MODEL_SERVICE_TICKET,this.centralAuthenticationService.grantServiceTicket(ticket,targetService));
  }
 catch (  final AbstractTicketException e) {
    return generateErrorView(e.getCode(),e.getCode(),new Object[]{ticket},request);
  }
catch (  final UnauthorizedServiceException e) {
    return generateErrorView(CasProtocolConstants.ERROR_CODE_UNAUTHORIZED_SERVICE,CasProtocolConstants.ERROR_CODE_UNAUTHORIZED_SERVICE_PROXY,new Object[]{targetService},request);
  }
}
