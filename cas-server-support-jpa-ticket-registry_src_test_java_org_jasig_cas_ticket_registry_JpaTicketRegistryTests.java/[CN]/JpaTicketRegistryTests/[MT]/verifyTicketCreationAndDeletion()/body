{
  final TicketGrantingTicket newTgt=newTGT();
  addTicketInTransaction(newTgt);
  TicketGrantingTicket tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertEquals(newTgt.getId(),tgtFromDb.getId());
  final ServiceTicket newSt=grantServiceTicketInTransaction(tgtFromDb);
  final ServiceTicket stFromDb=(ServiceTicket)getTicketInTransaction(newSt.getId());
  assertNotNull(stFromDb);
  assertEquals(newSt.getId(),stFromDb.getId());
  final ProxyGrantingTicket newPgt=grantProxyGrantingTicketInTransaction(stFromDb);
  final ProxyGrantingTicket pgtFromDb=(ProxyGrantingTicket)getTicketInTransaction(newPgt.getId());
  assertNotNull(pgtFromDb);
  assertEquals(newPgt.getId(),pgtFromDb.getId());
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertFalse(tgtFromDb.getProxyGrantingTickets().isEmpty());
  final ProxyTicket newPt=grantProxyTicketInTransaction(pgtFromDb);
  final ProxyTicket ptFromDb=(ProxyTicket)getTicketInTransaction(newPt.getId());
  assertNotNull(ptFromDb);
  assertEquals(newPt.getId(),ptFromDb.getId());
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  deleteTicketInTransaction(tgtFromDb.getId());
  assertNull(getTicketInTransaction(newTgt.getId()));
  assertNull(getTicketInTransaction(newSt.getId()));
  assertNull(getTicketInTransaction(newPgt.getId()));
  assertNull(getTicketInTransaction(newPt.getId()));
}
