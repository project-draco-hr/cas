{
  if (s == null) {
    throw new NullPointerException("Input string was null.");
  }
  byte[] bytes;
  try {
    bytes=s.getBytes(PREFERRED_ENCODING);
  }
 catch (  final java.io.UnsupportedEncodingException uee) {
    bytes=s.getBytes();
  }
  bytes=decode(bytes,0,bytes.length,options);
  final boolean dontGunzip=(options & DONT_GUNZIP) != 0;
  if ((bytes != null) && (bytes.length >= 4) && (!dontGunzip)) {
    final int head=((int)bytes[0] & 0xff) | ((bytes[1] << 8) & 0xff00);
    if (java.util.zip.GZIPInputStream.GZIP_MAGIC == head) {
      java.io.ByteArrayInputStream bais=null;
      java.util.zip.GZIPInputStream gzis=null;
      java.io.ByteArrayOutputStream baos=null;
      final byte[] buffer=new byte[2048];
      int length=0;
      try {
        baos=new java.io.ByteArrayOutputStream();
        bais=new java.io.ByteArrayInputStream(bytes);
        gzis=new java.util.zip.GZIPInputStream(bais);
        while ((length=gzis.read(buffer)) >= 0) {
          baos.write(buffer,0,length);
        }
        bytes=baos.toByteArray();
      }
 catch (      final java.io.IOException e) {
        e.printStackTrace();
      }
 finally {
        try {
          baos.close();
        }
 catch (        final Exception e) {
        }
        try {
          gzis.close();
        }
 catch (        final Exception e) {
        }
        try {
          bais.close();
        }
 catch (        final Exception e) {
        }
      }
    }
  }
  return bytes;
}
