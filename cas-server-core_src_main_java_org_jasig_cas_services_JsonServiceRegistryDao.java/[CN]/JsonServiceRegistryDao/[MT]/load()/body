{
  final Map<Long,RegisteredService> temp=new ConcurrentHashMap<Long,RegisteredService>();
  int errorCount=0;
  final Collection<File> c=FileUtils.listFiles(this.serviceRegistryDirectory,new String[]{FILE_EXTENSION},true);
  for (  final File file : c) {
    BufferedInputStream in=null;
    try {
      if (file.length() > 0) {
        in=new BufferedInputStream(new FileInputStream(file));
        final RegisteredService service=this.objectMapper.readValue(in,RegisteredService.class);
        temp.put(service.getId(),service);
      }
    }
 catch (    final Exception e) {
      errorCount++;
      LOGGER.error("Error reading configuration file",e);
    }
 finally {
      IOUtils.closeQuietly(in);
    }
  }
  if (errorCount == 0) {
    this.serviceMap=temp;
  }
  return new ArrayList<RegisteredService>(this.serviceMap.values());
}
