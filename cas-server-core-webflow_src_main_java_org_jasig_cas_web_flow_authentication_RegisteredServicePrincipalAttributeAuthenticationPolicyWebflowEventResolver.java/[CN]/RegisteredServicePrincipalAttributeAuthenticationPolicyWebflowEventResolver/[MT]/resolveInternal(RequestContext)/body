{
  final RegisteredService service=WebUtils.getRegisteredService(context);
  final Authentication authentication=WebUtils.getAuthentication(context);
  final RegisteredServiceAuthenticationPolicy policy=service.getAuthenticationPolicy();
  if (service.getAuthenticationPolicy().getMultifactorAuthenticationProviders().isEmpty()) {
    logger.debug("Authentication policy does not contain any multifactor authentication providers");
    return null;
  }
  if (StringUtils.isBlank(policy.getPrincipalAttributeNameTrigger()) || StringUtils.isBlank(policy.getPrincipalAttributeValueToMatch())) {
    logger.debug("Authentication policy does not define a principal attribute and/or value to trigger multifactor authentication");
    return null;
  }
  final Principal principal=authentication.getPrincipal();
  return resolveEventViaPrincipalAttribute(principal,policy.getPrincipalAttributeNameTrigger(),service,context,Predicates.containsPattern(policy.getPrincipalAttributeValueToMatch()));
}
