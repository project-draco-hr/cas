{
  try {
    if (svc.getId() == RegisteredService.INITIAL_IDENTIFIER_VALUE) {
      ((AbstractRegisteredService)svc).setId(System.nanoTime());
    }
    final String newDn=getDnForRegisteredService(dn,svc);
    LOGGER.debug("Creating entry {}",newDn);
    final Collection<LdapAttribute> attrs=new ArrayList<LdapAttribute>();
    attrs.add(new LdapAttribute(this.idAttribute,String.valueOf(svc.getId())));
    final StringWriter writer=new StringWriter();
    this.jsonSerializer.toJson(writer,svc);
    attrs.add(new LdapAttribute(this.serviceDefinitionAttribute,writer.toString()));
    attrs.add(new LdapAttribute(LdapUtils.OBJECTCLASS_ATTRIBUTE,"top",this.objectClass));
    return new LdapEntry(newDn,attrs);
  }
 catch (  final Exception e) {
    throw new RuntimeException(e);
  }
}
