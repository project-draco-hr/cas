{
  if (rs.getId() != RegisteredService.INITIAL_IDENTIFIER_VALUE) {
    return update(rs);
  }
  Connection connection=null;
  try {
    connection=this.connectionFactory.getConnection();
    final AddOperation operation=new AddOperation(connection);
    final LdapEntry entry=this.ldapServiceMapper.mapFromRegisteredService(this.searchRequest.getBaseDn(),rs);
    operation.execute(new AddRequest(entry.getDn(),entry.getAttributes()));
  }
 catch (  final LdapException e) {
    logger.error(e.getMessage(),e);
  }
 finally {
    LdapUtils.closeConnection(connection);
  }
  return rs;
}
