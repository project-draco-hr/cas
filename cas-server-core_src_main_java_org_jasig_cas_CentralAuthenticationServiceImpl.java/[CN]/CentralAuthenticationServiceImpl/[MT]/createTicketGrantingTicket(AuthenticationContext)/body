{
  if (context.isEmpty()) {
    final String msg="No authentication context is available in the request for creating a new ticket-granting ticket";
    logger.warn(msg);
    throw new TicketCreationException(new IllegalArgumentException(msg));
  }
  final Authentication authentication=context.getPrimaryAuthentication();
  final TicketGrantingTicketFactory factory=this.ticketFactory.get(TicketGrantingTicket.class);
  final TicketGrantingTicket ticketGrantingTicket=factory.create(authentication);
  this.ticketRegistry.addTicket(ticketGrantingTicket);
  doPublishEvent(new CasTicketGrantingTicketCreatedEvent(this,ticketGrantingTicket));
  return ticketGrantingTicket;
}
