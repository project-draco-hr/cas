{
  Assert.notNull(ticketGrantingTicketId,"ticketGrantingTicketId cannot be null");
  final TicketGrantingTicket ticketGrantingTicket=this.ticketRegistry.getTicket(ticketGrantingTicketId,TicketGrantingTicket.class);
  if (ticketGrantingTicket == null) {
    logger.debug("TicketGrantingTicket [{}] cannot be found in the ticket registry.",ticketGrantingTicketId);
    throw new InvalidTicketException(ticketGrantingTicketId);
  }
synchronized (ticketGrantingTicket) {
    if (ticketGrantingTicket.isExpired()) {
      this.ticketRegistry.deleteTicket(ticketGrantingTicketId);
      logger.debug("TicketGrantingTicket [{}] has expired and is now deleted from the ticket registry.",ticketGrantingTicketId);
      throw new InvalidTicketException(ticketGrantingTicketId);
    }
  }
  return ticketGrantingTicket;
}
