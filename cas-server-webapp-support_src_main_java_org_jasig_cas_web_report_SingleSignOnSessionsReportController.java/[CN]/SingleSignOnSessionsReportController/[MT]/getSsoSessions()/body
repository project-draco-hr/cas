{
  final List<Map<String,Object>> activeSessions=new ArrayList<Map<String,Object>>();
  for (  final Ticket ticket : getNonExpiredTicketGrantingTickets()) {
    final TicketGrantingTicket tgt=(TicketGrantingTicket)ticket;
    final Map<String,Object> sso=new HashMap<>(SsoSessionAttributeKeys.values().length);
    sso.put(SsoSessionAttributeKeys.AUTHENTICATED_PRINCIPAL.toString(),tgt.getAuthentication().getPrincipal().getId());
    sso.put(SsoSessionAttributeKeys.AUTHENTICATION_DATE.toString(),tgt.getAuthentication().getAuthenticationDate());
    sso.put(SsoSessionAttributeKeys.NUMBER_OF_USES.toString(),tgt.getCountOfUses());
    if (this.includeTicketGrantingTicketId) {
      sso.put(SsoSessionAttributeKeys.TICKET_GRANTING_TICKET.toString(),tgt.getId());
    }
    activeSessions.add(Collections.unmodifiableMap(sso));
  }
  return Collections.unmodifiableCollection(activeSessions);
}
