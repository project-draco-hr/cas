{
  final StringBuilder builder=new StringBuilder(givenCookieValue);
  String remoteAddr=request.getHeader("X-FORWARDED-FOR");
  if (remoteAddr == null) {
    remoteAddr=request.getRemoteAddr();
  }
  if (StringUtils.isBlank(remoteAddr)) {
    throw new IllegalStateException("Request does not specify a remote address");
  }
  builder.append(COOKIE_FIELD_SEPARATOR);
  builder.append(remoteAddr);
  final String userAgent=request.getHeader("user-agent");
  if (StringUtils.isBlank(userAgent)) {
    throw new IllegalStateException("Request does not specify a user-agent");
  }
  builder.append(COOKIE_FIELD_SEPARATOR);
  builder.append(userAgent);
  final String res=builder.toString();
  LOGGER.debug("Encoding cookie value [{}]",res);
  return this.cipherExecutor.encode(res);
}
