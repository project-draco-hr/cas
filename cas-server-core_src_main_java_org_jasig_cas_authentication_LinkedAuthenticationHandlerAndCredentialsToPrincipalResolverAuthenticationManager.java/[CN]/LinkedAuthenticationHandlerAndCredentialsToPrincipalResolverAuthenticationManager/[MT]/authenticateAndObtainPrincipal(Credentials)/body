{
  boolean foundOneThatWorks=false;
  for (  final AuthenticationHandler authenticationHandler : this.linkedHandlers.keySet()) {
    if (!authenticationHandler.supports(credentials)) {
      continue;
    }
    foundOneThatWorks=true;
    boolean authenticated=false;
    final LoggingStopWatch stopWatch=new LoggingStopWatch(authenticationHandler.getClass().getSimpleName());
    try {
      authenticated=authenticationHandler.authenticate(credentials);
    }
  finally {
      stopWatch.stop();
    }
    if (authenticated) {
      final Principal p=this.linkedHandlers.get(authenticationHandler).resolvePrincipal(credentials);
      return new Pair<AuthenticationHandler,Principal>(authenticationHandler,p);
    }
  }
  if (foundOneThatWorks) {
    throw BadCredentialsAuthenticationException.ERROR;
  }
  throw UnsupportedCredentialsException.ERROR;
}
