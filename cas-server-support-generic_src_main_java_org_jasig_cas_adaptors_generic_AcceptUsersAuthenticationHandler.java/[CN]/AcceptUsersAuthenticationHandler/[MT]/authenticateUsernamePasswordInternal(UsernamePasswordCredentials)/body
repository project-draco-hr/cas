{
  final String transformedUsername=getPrincipalNameTransformer().transform(credentials.getUsername());
  final String cachedPassword=this.users.get(transformedUsername);
  if (cachedPassword == null) {
    logger.debug("The user [{}] was not found in the map.",transformedUsername);
    return false;
  }
  final String encodedPassword=this.getPasswordEncoder().encode(credentials.getPassword());
  return (cachedPassword.equals(encodedPassword));
}
