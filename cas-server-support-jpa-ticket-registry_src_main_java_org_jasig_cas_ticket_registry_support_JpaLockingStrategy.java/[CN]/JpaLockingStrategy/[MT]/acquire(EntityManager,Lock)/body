{
  lock.setUniqueId(uniqueId);
  if (lockTimeout > 0) {
    lock.setExpirationDate(ZonedDateTime.now(ZoneOffset.UTC).plusSeconds(lockTimeout));
  }
 else {
    lock.setExpirationDate(null);
  }
  boolean success=false;
  try {
    if (lock.getApplicationId() != null) {
      em.merge(lock);
    }
 else {
      lock.setApplicationId(applicationId);
      em.persist(lock);
    }
    success=true;
  }
 catch (  final PersistenceException e) {
    success=false;
    if (logger.isDebugEnabled()) {
      logger.debug("{} could not obtain {} lock.",uniqueId,applicationId,e);
    }
 else {
      logger.info("{} could not obtain {} lock.",uniqueId,applicationId);
    }
  }
  return success;
}
