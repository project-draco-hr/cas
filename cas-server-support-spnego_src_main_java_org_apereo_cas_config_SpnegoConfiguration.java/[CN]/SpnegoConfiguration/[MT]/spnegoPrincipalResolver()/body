{
  final SpnegoPrincipalResolver r=new SpnegoPrincipalResolver();
  if (transformer != null) {
    r.setPrincipalNameTransformer(transformer);
  }
  r.setAttributeRepository(attributeRepository);
  r.setPrincipalAttributeName(casProperties.getAuthn().getSpnego().getPrincipal().getPrincipalAttribute());
  r.setReturnNullIfNoAttributes(casProperties.getAuthn().getSpnego().getPrincipal().isReturnNull());
  r.setPrincipalFactory(spnegoPrincipalFactory());
  return r;
}
