{
  try {
    final AuthyAuthenticationHandler h=new AuthyAuthenticationHandler(casProperties.getAuthn().getMfa().getAuthy().getApiKey(),casProperties.getAuthn().getMfa().getAuthy().getApiUrl(),authyAccountRegistry());
    h.setServicesManager(servicesManager);
    h.setPhoneAttribute(casProperties.getAuthn().getMfa().getAuthy().getPhoneAttribute());
    h.setPrincipalFactory(authyPrincipalFactory());
    h.setMailAttribute(casProperties.getAuthn().getMfa().getAuthy().getMailAttribute());
    h.setForceVerification(casProperties.getAuthn().getMfa().getAuthy().isForceVerification());
    return h;
  }
 catch (  final Exception e) {
    throw Throwables.propagate(e);
  }
}
