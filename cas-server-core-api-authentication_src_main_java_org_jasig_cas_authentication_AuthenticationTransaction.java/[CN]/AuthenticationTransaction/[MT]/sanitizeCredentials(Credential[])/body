{
  if (credentials != null && credentials.length > 0) {
    final Set<Credential> set=new HashSet<>(Arrays.asList(credentials));
    final Iterator<Credential> it=set.iterator();
    while (it.hasNext()) {
      if (it.next() == null) {
        it.remove();
      }
    }
    if (set.isEmpty()) {
      throw new RuntimeException("Credential specified for authentication were all null and removed from the collection");
    }
    return set;
  }
  return Collections.emptySet();
}
