{
  final ApplicationContext context=ApplicationContextProvider.getApplicationContext();
  if (context != null) {
    try {
      final PrincipalAttributesRepository repository=context.getBean(PrincipalAttributesRepository.class);
      logger.debug("Found an instance of {} in the context, which will be used to retrieve principal attributes",PrincipalAttributesRepository.class.getSimpleName());
      return repository.getAttributes(p);
    }
 catch (    final Exception e) {
      logger.trace("No bean of type {} exists in the application context",PrincipalAttributesRepository.class.getSimpleName(),e);
    }
  }
  logger.debug("Retrieving principal attributes from the principal object");
  return p.getAttributes();
}
