{
  this.ticketRegistry=new DefaultTicketRegistry();
  final OpenIdCredentialsAuthenticationHandler handler=new OpenIdCredentialsAuthenticationHandler();
  handler.setTicketRegistry(this.ticketRegistry);
  this.authenticationManager=new PolicyBasedAuthenticationManager(Collections.<AuthenticationHandler,CredentialsToPrincipalResolver>singletonMap(handler,new OpenIdCredentialsToPrincipalResolver()));
  final Map<String,UniqueTicketIdGenerator> generator=new HashMap<String,UniqueTicketIdGenerator>();
  generator.put(OpenIdService.class.getName(),new DefaultUniqueTicketIdGenerator());
  this.impl.setAuthenticationManager(this.authenticationManager);
  this.impl.setServicesManager(new DefaultServicesManagerImpl(new InMemoryServiceRegistryDaoImpl()));
  this.impl.setServiceTicketExpirationPolicy(new NeverExpiresExpirationPolicy());
  this.impl.setTicketGrantingTicketExpirationPolicy(new NeverExpiresExpirationPolicy());
  this.impl.setTicketGrantingTicketUniqueTicketIdGenerator(new DefaultUniqueTicketIdGenerator());
  this.impl.setTicketRegistry(this.ticketRegistry);
  this.impl.setUniqueTicketIdGeneratorsForService(generator);
  this.action=new OpenIdSingleSignOnAction();
  this.action.setCentralAuthenticationService(this.impl);
  this.action.setExtractor(new DefaultOpenIdUserNameExtractor());
  this.action.afterPropertiesSet();
}
