{
  if (this.webflowSessionStorage) {
    final SessionBindingConversationManager conversationManager=new SessionBindingConversationManager();
    conversationManager.setLockTimeoutSeconds(this.webflowSessionLockTimeout);
    conversationManager.setMaxConversations(this.webflowSessionMaxConversations);
    final FlowExecutionImplFactory executionFactory=new FlowExecutionImplFactory();
    final SerializedFlowExecutionSnapshotFactory flowExecutionSnapshotFactory=new SerializedFlowExecutionSnapshotFactory(executionFactory,loginFlowRegistry());
    flowExecutionSnapshotFactory.setCompress(this.webflowSessionCompress);
    final DefaultFlowExecutionRepository repository=new DefaultFlowExecutionRepository(conversationManager,flowExecutionSnapshotFactory);
    executionFactory.setExecutionKeyFactory(repository);
    return new FlowExecutorImpl(loginFlowRegistry(),executionFactory,repository);
  }
  final ClientFlowExecutionRepository repository=new ClientFlowExecutionRepository();
  repository.setFlowDefinitionLocator(loginFlowRegistry());
  repository.setTranscoder(loginFlowStateTranscoder());
  final FlowExecutionImplFactory factory=new FlowExecutionImplFactory();
  factory.setExecutionKeyFactory(repository);
  repository.setFlowExecutionFactory(factory);
  return new FlowExecutorImpl(loginFlowRegistry(),factory,repository);
}
