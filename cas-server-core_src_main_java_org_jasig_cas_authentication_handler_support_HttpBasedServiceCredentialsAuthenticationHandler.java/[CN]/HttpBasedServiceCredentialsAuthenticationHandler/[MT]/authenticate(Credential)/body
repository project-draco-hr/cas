{
  final HttpBasedServiceCredential httpCredential=(HttpBasedServiceCredential)credential;
  if (this.requireSecure && !httpCredential.getCallbackUrl().getProtocol().equals(PROTOCOL_HTTPS)) {
    logger.debug("Authentication failed because url was not secure.");
    throw new FailedLoginException(httpCredential.getCallbackUrl() + " is not an HTTPS endpoint as required.");
  }
  if (httpCredential.getService().getProxyPolicy().isAllowedProxyCallbackUrl(httpCredential.getCallbackUrl())) {
    logger.warn("Proxy policy for service [{}] cannot authorize the requested callbackurl [{}]",httpCredential.getService(),httpCredential.getCallbackUrl());
    throw new FailedLoginException(httpCredential.getCallbackUrl() + " cannot be authorized");
  }
  logger.debug("Attempting to authenticate {}",httpCredential);
  if (!this.httpClient.isValidEndPoint(httpCredential.getCallbackUrl())) {
    throw new FailedLoginException(httpCredential.getCallbackUrl() + " sent an unacceptable response status code");
  }
  return new HandlerResult(this,httpCredential,new SimplePrincipal(httpCredential.getId()));
}
