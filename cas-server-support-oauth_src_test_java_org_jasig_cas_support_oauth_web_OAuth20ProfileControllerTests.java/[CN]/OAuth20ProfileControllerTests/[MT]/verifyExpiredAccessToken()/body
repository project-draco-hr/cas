{
  final Principal principal=org.jasig.cas.authentication.TestUtils.getPrincipal(ID,new HashMap<String,Object>());
  final Authentication authentication=new OAuthAuthentication(ZonedDateTime.now(),principal);
  final DefaultAccessTokenFactory expiringAccessTokenFactory=new DefaultAccessTokenFactory();
  expiringAccessTokenFactory.setExpirationPolicy(new ExpirationPolicy(){
    @Override public boolean isExpired(    final TicketState ticketState){
      return true;
    }
  }
);
  final AccessTokenImpl accessToken=(AccessTokenImpl)expiringAccessTokenFactory.create(TestUtils.getService(),authentication);
  oAuth20ProfileController.getTicketRegistry().addTicket(accessToken);
  final MockHttpServletRequest mockRequest=new MockHttpServletRequest("GET",CONTEXT + OAuthConstants.PROFILE_URL);
  mockRequest.setParameter(OAuthConstants.ACCESS_TOKEN,accessToken.getId());
  final MockHttpServletResponse mockResponse=new MockHttpServletResponse();
  oAuth20ProfileController.handleRequest(mockRequest,mockResponse);
  assertEquals(200,mockResponse.getStatus());
  assertEquals("{\"error\":\"" + OAuthConstants.EXPIRED_ACCESS_TOKEN + "\"}",mockResponse.getContentAsString());
}
