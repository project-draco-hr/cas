{
  final Map<String,Object> map=new HashMap<>();
  map.put(NAME,VALUE);
  final List<String> list=Arrays.asList(VALUE,VALUE);
  map.put(NAME2,list);
  final Principal p=org.jasig.cas.authentication.TestUtils.getPrincipal(ID,map);
  final TicketGrantingTicket impl=new TicketGrantingTicketImpl(TGT_ID,org.jasig.cas.authentication.TestUtils.getAuthentication(p),new NeverExpiresExpirationPolicy());
  final CommonProfile profile=new CommonProfile();
  profile.setId(ID);
  profile.addAttributes(map);
  oAuth20ProfileController.getTicketRegistry().addTicket(impl);
  final MockHttpServletRequest mockRequest=new MockHttpServletRequest("GET",CONTEXT + OAuthConstants.PROFILE_URL);
  mockRequest.setParameter(OAuthConstants.ACCESS_TOKEN,"");
  final MockHttpServletResponse mockResponse=new MockHttpServletResponse();
  oAuth20ProfileController.handleRequest(mockRequest,mockResponse);
  assertEquals(200,mockResponse.getStatus());
  assertEquals(CONTENT_TYPE,mockResponse.getContentType());
  final ObjectMapper mapper=new ObjectMapper();
  final String expected="{\"id\":\"" + ID + "\",\"attributes\":[{\""+ NAME+ "\":\""+ VALUE+ "\"},{\""+ NAME2+ "\":[\""+ VALUE+ "\",\""+ VALUE+ "\"]}]}";
  final JsonNode expectedObj=mapper.readTree(expected);
  final JsonNode receivedObj=mapper.readTree(mockResponse.getContentAsString());
  assertEquals(expectedObj.get("id").asText(),receivedObj.get("id").asText());
  final JsonNode expectedAttributes=expectedObj.get("attributes");
  final JsonNode receivedAttributes=receivedObj.get("attributes");
  assertEquals(expectedAttributes.findValue(NAME).asText(),receivedAttributes.findValue(NAME).asText());
  assertEquals(expectedAttributes.findValues(NAME2),receivedAttributes.findValues(NAME2));
}
