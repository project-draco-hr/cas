{
  final String encryptedPassword=this.getPasswordEncoder().encode(credential.getPassword());
  try {
    final String dbPassword=getJdbcTemplate().queryForObject(this.sql,String.class,credential.getUsername());
    if (!dbPassword.equals(encryptedPassword)) {
      throw new FailedLoginException("Password does not match value on record.");
    }
  }
 catch (  final IncorrectResultSizeDataAccessException e) {
    if (e.getActualSize() == 0) {
      throw new AccountNotFoundException(credential.getUsername() + " not found with SQL query");
    }
 else {
      throw new FailedLoginException("Multiple records found for " + credential.getUsername());
    }
  }
catch (  final DataAccessException e) {
    throw new PreventedException("SQL exception while executing query for " + credential.getUsername(),e);
  }
  return createHandlerResult(credential,new SimplePrincipal(credential.getUsername()),null);
}
