{
  logger.debug("Attempting to build an event based on the authentication method [{}] and service [{}]",service.getAuthenticationPolicy().getAuthenticationMethod(),service.getName());
  final Event event=new Event(this,MFA_EVENT_ID_PREFIX + service.getAuthenticationPolicy().getAuthenticationMethod());
  logger.debug("Resulting event id is [{}]. Locating transitions in the context for that event id...",event.getId());
  final TransitionDefinition def=context.getMatchingTransition(event.getId());
  if (def == null) {
    logger.warn("Transition definition cannot be found for event [{}]",event.getId());
    throw new UnrecognizedAuthenticationMethodException(service.getAuthenticationPolicy().getAuthenticationMethod());
  }
  logger.debug("Found matching transition [{}] with target [{}] for event [{}].",def.getId(),def.getTargetStateId(),event.getId());
  WebUtils.putAuthenticationContextBuilder(builder,context);
  WebUtils.putAuthenticationContext(authenticationContext,context);
  return event;
}
