{
  final Service service=WebUtils.getService(context);
  final String ticketGrantingTicket=WebUtils.getTicketGrantingTicketId(context);
  try {
    final String serviceTicketId=this.centralAuthenticationService.grantServiceTicket(ticketGrantingTicket,service);
    WebUtils.putServiceTicketInRequestScope(context,serviceTicketId);
    return success();
  }
 catch (  final TicketException e) {
    if (e instanceof InvalidTicketException) {
      this.centralAuthenticationService.destroyTicketGrantingTicket(ticketGrantingTicket);
    }
    if (isGatewayPresent(context)) {
      return result("gateway");
    }
  }
  return error();
}
