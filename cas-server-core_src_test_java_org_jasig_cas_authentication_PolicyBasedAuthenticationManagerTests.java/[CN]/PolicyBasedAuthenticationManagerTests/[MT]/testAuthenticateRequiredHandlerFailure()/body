{
  final PolicyBasedAuthenticationManager manager=new PolicyBasedAuthenticationManager(newMockHandler("HandlerA",true),newMockHandler("HandlerB",false));
  manager.setAuthenticationPolicy(new RequiredHandlerAuthenticationPolicy("HandlerB"));
  manager.authenticate(mock(Credentials.class),mock(Credentials.class));
  fail("Should have thrown AuthenticationException");
}
