{
  final PolicyBasedAuthenticationManager manager=new PolicyBasedAuthenticationManager(newMockHandler("HandlerA",true),newMockHandler("HandlerB",false));
  manager.setAuthenticationPolicy(new RequiredHandlerAuthenticationPolicy("HandlerB"));
  manager.authenticate(mock(Credential.class),mock(Credential.class));
  fail("Should have thrown AuthenticationException");
}
