{
  final TicketGrantingTicket newTgt=newTGT();
  addTicketInTransaction(newTgt);
  TicketGrantingTicket tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertEquals(newTgt.getId(),tgtFromDb.getId());
  final ServiceTicket newSt=grantServiceTicketInTransaction(tgtFromDb);
  final ServiceTicket stFromDb=(ServiceTicket)getTicketInTransaction(newSt.getId());
  assertNotNull(stFromDb);
  assertEquals(newSt.getId(),stFromDb.getId());
  final ProxyGrantingTicket newPgt=grantProxyGrantingTicketInTransaction(stFromDb);
  final ProxyGrantingTicket pgtFromDb=(ProxyGrantingTicket)getTicketInTransaction(newPgt.getId());
  assertNotNull(pgtFromDb);
  assertEquals(newPgt.getId(),pgtFromDb.getId());
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertEquals(1,tgtFromDb.getProxyGrantingTickets().size());
  final ProxyTicket newPt=grantProxyTicketInTransaction(pgtFromDb);
  final ProxyTicket ptFromDb=(ProxyTicket)getTicketInTransaction(newPt.getId());
  assertNotNull(ptFromDb);
  assertEquals(newPt.getId(),ptFromDb.getId());
  final ServiceTicket newSt2=grantServiceTicketInTransaction(tgtFromDb);
  final ServiceTicket st2FromDb=(ServiceTicket)getTicketInTransaction(newSt2.getId());
  assertNotNull(st2FromDb);
  assertEquals(newSt2.getId(),st2FromDb.getId());
  final ProxyGrantingTicket newPgt2=grantProxyGrantingTicketInTransaction(st2FromDb);
  final ProxyGrantingTicket pgt2FromDb=(ProxyGrantingTicket)getTicketInTransaction(newPgt2.getId());
  assertNotNull(pgt2FromDb);
  assertEquals(newPgt2.getId(),pgt2FromDb.getId());
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertEquals(2,tgtFromDb.getProxyGrantingTickets().size());
  deleteTicketInTransaction(pgt2FromDb.getId());
  assertNull(getTicketInTransaction(newPgt2.getId()));
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  assertEquals(1,tgtFromDb.getProxyGrantingTickets().size());
  tgtFromDb=(TicketGrantingTicket)getTicketInTransaction(newTgt.getId());
  assertNotNull(tgtFromDb);
  deleteTicketInTransaction(tgtFromDb.getId());
  assertNull(getTicketInTransaction(newTgt.getId()));
  assertNull(getTicketInTransaction(newSt.getId()));
  assertNull(getTicketInTransaction(newPgt.getId()));
  assertNull(getTicketInTransaction(newPt.getId()));
}
