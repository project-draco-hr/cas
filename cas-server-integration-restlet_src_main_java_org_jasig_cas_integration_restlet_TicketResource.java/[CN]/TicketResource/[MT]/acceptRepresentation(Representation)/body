{
  LOGGER.debug("Obtaining credentials...");
  final Credential c=obtainCredentials();
  if (c == null) {
    LOGGER.trace("No credentials could be obtained from the REST entity representation");
    getResponse().setStatus(Status.CLIENT_ERROR_BAD_REQUEST,"Invalid or missing credentials");
    return;
  }
  try (final Formatter fmt=new Formatter()){
    final TicketGrantingTicket ticketGrantingTicketId=this.centralAuthenticationService.createTicketGrantingTicket(c);
    getResponse().setStatus(determineStatus());
    final Reference ticketReference=getRequest().getResourceRef().addSegment(ticketGrantingTicketId.getId());
    getResponse().setLocationRef(ticketReference);
    fmt.format("<!DOCTYPE HTML PUBLIC \\\"-//IETF//DTD HTML 2.0//EN\\\"><html><head><title>");
    fmt.format("%s %s",getResponse().getStatus().getCode(),getResponse().getStatus().getDescription()).format("</title></head><body><h1>TGT Created</h1><form action=\"%s",ticketReference).format("\" method=\"POST\">Service:<input type=\"text\" name=\"service\" value=\"\">").format("<br><input type=\"submit\" value=\"Submit\"></form></body></html>");
    getResponse().setEntity(fmt.toString(),MediaType.TEXT_HTML);
  }
 catch (  final Exception e) {
    LOGGER.error(e.getMessage(),e);
    getResponse().setStatus(Status.CLIENT_ERROR_BAD_REQUEST,e.getMessage());
  }
}
