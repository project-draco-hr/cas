{
  log.debug("Obtaining credentials...");
  final Credentials c=obtainCredentials();
  Formatter fmt=null;
  try {
    final String ticketGrantingTicketId=this.centralAuthenticationService.createTicketGrantingTicket(c);
    getResponse().setStatus(determineStatus());
    final Reference ticketReference=getRequest().getResourceRef().addSegment(ticketGrantingTicketId);
    getResponse().setLocationRef(ticketReference);
    fmt=new Formatter();
    fmt.format("<!DOCTYPE HTML PUBLIC \\\"-//IETF//DTD HTML 2.0//EN\\\"><html><head><title>");
    fmt.format("%s %s",getResponse().getStatus().getCode(),getResponse().getStatus().getDescription());
    fmt.format("</title></head><body><h1>TGT Created</h1><form action=\"%s",ticketReference);
    fmt.format("\" method=\"POST\">Service:<input type=\"text\" name=\"service\" value=\"\">");
    fmt.format("<br><input type=\"submit\" value=\"Submit\"></form></body></html>");
    getResponse().setEntity(fmt.toString(),MediaType.TEXT_HTML);
  }
 catch (  final TicketException e) {
    log.error(e.getMessage(),e);
    getResponse().setStatus(Status.CLIENT_ERROR_BAD_REQUEST,e.getMessage());
  }
 finally {
    IOUtils.closeQuietly(fmt);
  }
}
