{
  authenticationSupervisor.authenticate(newUserPassCredentials("alice","alice"));
  final AuthenticationContext ctx=authenticationSupervisor.build();
  final TicketGrantingTicket tgt=cas.createTicketGrantingTicket(ctx);
  assertNotNull(tgt);
  final Service service=newService("https://example.com/high/");
  authenticationSupervisor.authenticate(newUserPassCredentials("alice","alice"),new OneTimePasswordCredential("alice","31415"));
  final AuthenticationContext ctx2=authenticationSupervisor.build();
  final ServiceTicket st=cas.grantServiceTicket(tgt.getId(),service,ctx2);
  assertNotNull(st);
  final Assertion assertion=cas.validateServiceTicket(st.getId(),service);
  assertEquals(2,assertion.getPrimaryAuthentication().getSuccesses().size());
  assertTrue(assertion.getPrimaryAuthentication().getSuccesses().containsKey("passwordHandler"));
  assertTrue(assertion.getPrimaryAuthentication().getSuccesses().containsKey("oneTimePasswordHandler"));
  assertTrue(assertion.getPrimaryAuthentication().getAttributes().containsKey(SuccessfulHandlerMetaDataPopulator.SUCCESSFUL_AUTHENTICATION_HANDLERS));
}
