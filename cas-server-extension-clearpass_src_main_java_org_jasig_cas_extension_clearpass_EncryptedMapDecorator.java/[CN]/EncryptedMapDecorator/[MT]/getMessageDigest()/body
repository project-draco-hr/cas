{
  if (this.cloneNotSupported) {
    final String algorithm=this.messageDigest.getAlgorithm();
    try {
      return MessageDigest.getInstance(algorithm);
    }
 catch (    final NoSuchAlgorithmException e) {
      throw new IllegalStateException("MessageDigest algorithm '" + algorithm + "' was supported when "+ this.getClass().getSimpleName()+ " was created but is not now. This should not be possible.",e);
    }
  }
  try {
    return (MessageDigest)this.messageDigest.clone();
  }
 catch (  final CloneNotSupportedException e) {
    this.cloneNotSupported=true;
    final String msg=String.format("Could not clone MessageDigest using algorithm '%s'. " + "MessageDigest.getInstance will be used from now on which will be much more expensive.",this.messageDigest.getAlgorithm());
    logger.warn(msg,e);
    return this.getMessageDigest();
  }
}
