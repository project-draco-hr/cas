{
  final AccountState state=response.getAccountState();
  if (state == null) {
    return Collections.emptyList();
  }
  final LoginException error=ERROR_MAP.get(state.getError());
  if (error != null) {
    throw error;
  }
  final List<Message> messages=new ArrayList<Message>();
  if (state.getWarning() != null) {
    final Calendar expDate=state.getWarning().getExpiration();
    final Days ttl=Days.daysBetween(Instant.now(),new Instant(expDate));
    if (ttl.getDays() < configuration.getPasswordWarningNumberOfDays()) {
      messages.add(new PasswordExpiringWarningMessage("Password expires in {0} days. Please change your password at <href=\"{1}\">{1}</a>",ttl.getDays(),configuration.getPasswordPolicyUrl()));
    }
    if (state.getWarning().getLoginsRemaining() > 0) {
      messages.add(new Message("password.expiration.loginsRemaining","You have {0} logins remaining before you MUST change your password.",state.getWarning().getLoginsRemaining()));
    }
  }
  return messages;
}
