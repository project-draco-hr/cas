{
  assertEquals(this.principal.getAttributes().size(),1);
  final PrincipalAttributesRepository repository=new CachingPrincipalAttributesRepository(this.dao,TimeUnit.MILLISECONDS,100);
  assertEquals(repository.getAttributes(this.principal).size(),this.attributes.size());
  assertTrue(repository.getAttributes(this.principal).containsKey("mail"));
  Thread.sleep(200);
  this.attributes.remove("mail");
  assertTrue(repository.getAttributes(this.principal).containsKey("a2"));
  assertFalse(repository.getAttributes(this.principal).containsKey("mail"));
  ((Closeable)repository).close();
}
