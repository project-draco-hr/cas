{
  final Map<String,Object> map=new HashMap<String,Object>();
  map.put("attr1","val1");
  map.put("attr2","val2");
  final Principal p=TestUtils.getPrincipal("principal",map);
  final Authentication authn=TestUtils.getAuthentication(p);
  final TicketGrantingTicket tgt=mock(TicketGrantingTicket.class);
  when(tgt.getAuthentication()).thenReturn(authn);
  final TicketRegistry registry=mock(TicketRegistry.class);
  when(registry.getTicket(any(String.class))).thenReturn(tgt);
  when(registry.getTicket(any(String.class),any(Class.class))).thenReturn(tgt);
  final AuthenticationSupport support=new DefaultAuthenticationSupport(registry);
  assertEquals(support.getAuthenticationFrom("TGT"),authn);
  assertEquals(support.getAuthenticatedPrincipalFrom("TGT"),p);
  assertEquals(support.getPrincipalAttributesFrom("TGT"),map);
}
