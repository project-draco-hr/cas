{
  final PrincipalAttributesProperties.Jdbc jdbc=casProperties.getAuthn().getAttributeRepository().getJdbc();
  if (!casProperties.getAuthn().getAttributeRepository().getAttributes().isEmpty() && StringUtils.isNotBlank(jdbc.getSql())) {
    final AbstractJdbcPersonAttributeDao jdbcDao;
    if (jdbc.isSingleRow()) {
      jdbcDao=new SingleRowJdbcPersonAttributeDao(Beans.newHickariDataSource(jdbc),jdbc.getSql());
    }
 else {
      jdbcDao=new MultiRowJdbcPersonAttributeDao(Beans.newHickariDataSource(jdbc),jdbc.getSql());
      ((MultiRowJdbcPersonAttributeDao)jdbcDao).setNameValueColumnMappings(jdbc.getColumnMappings());
    }
    jdbcDao.setQueryAttributeMapping(ImmutableMap.of("username",jdbc.getUsername()));
    jdbcDao.setResultAttributeMapping(casProperties.getAuthn().getAttributeRepository().getAttributes());
    jdbcDao.setRequireAllQueryAttributes(jdbc.isRequireAllAttributes());
    jdbcDao.setUsernameCaseCanonicalizationMode(jdbc.getCaseCanonicalization());
    jdbcDao.setQueryType(jdbc.getQueryType());
    list.add(jdbcDao);
  }
}
