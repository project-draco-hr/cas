{
  this.id=id;
  final CredentialMetaData credentialMetaData=new BasicCredentialMetaData(credential);
  final DefaultAuthenticationBuilder builder=new DefaultAuthenticationBuilder();
  builder.setPrincipal(this.principalFactory.createPrincipal(USERNAME,principalAttributes));
  builder.setAuthenticationDate(new Date());
  builder.addCredential(credentialMetaData);
  builder.addAttribute(RememberMeCredential.AUTHENTICATION_ATTRIBUTE_REMEMBER_ME,Boolean.TRUE);
  final AuthenticationHandler handler=new MockAuthenticationHandler();
  try {
    builder.addSuccess(handler.getName(),handler.authenticate(credential));
  }
 catch (  final Exception e) {
    throw new RuntimeException(e);
  }
  builder.addFailure(handler.getName(),FailedLoginException.class);
  this.authentication=builder.build();
}
