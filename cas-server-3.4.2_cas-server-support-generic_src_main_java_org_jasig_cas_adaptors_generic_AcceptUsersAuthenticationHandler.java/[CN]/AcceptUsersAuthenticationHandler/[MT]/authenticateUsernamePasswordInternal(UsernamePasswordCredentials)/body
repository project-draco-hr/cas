{
  final String transformedUsername=getPrincipalNameTransformer().transform(credentials.getUsername());
  final String cachedPassword=this.users.get(transformedUsername);
  if (cachedPassword == null) {
    if (log.isDebugEnabled()) {
      log.debug("The user [" + transformedUsername + "] was not found in the map.");
    }
    return false;
  }
  final String encodedPassword=this.getPasswordEncoder().encode(credentials.getPassword());
  return (cachedPassword.equals(encodedPassword));
}
