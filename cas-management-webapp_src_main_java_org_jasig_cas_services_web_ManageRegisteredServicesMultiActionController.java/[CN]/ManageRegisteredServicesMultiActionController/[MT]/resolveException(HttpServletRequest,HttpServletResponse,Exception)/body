{
  LOGGER.error(ex.getMessage(),ex);
  final String contentType=request.getHeader(this.AJAX_REQUEST_HEADER_NAME);
  if (contentType != null && contentType.equals(this.AJAX_REQUEST_HEADER_VALUE)) {
    LOGGER.debug("Handling exception {} for ajax request indicated by header {}",ex.getClass().getName(),this.AJAX_REQUEST_HEADER_NAME);
    final Map<String,String> map=new HashMap<>();
    map.put("error",ex.getMessage());
    map.put("stacktrace",Arrays.deepToString(ex.getStackTrace()));
    JsonViewUtils.render(map,response);
  }
 else {
    LOGGER.trace("Unable to resolve exception {} for request. Ajax request header {} not found.",ex.getClass().getName(),this.AJAX_REQUEST_HEADER_NAME);
  }
}
