{
  final String id=String.valueOf(new SecureRandom().nextLong());
  final Response samlResponse=newResponse(id,new DateTime(),authnRequest.getID(),null);
  samlResponse.setVersion(SAMLVersion.VERSION_20);
  samlResponse.setIssuer(buildEntityIssuer());
  org.opensaml.saml.saml2.core.Assertion assertion=null;
  if (statements != null && !statements.isEmpty()) {
    assertion=newAssertion(statements,this.entityId,new DateTime(),id);
    assertion.setSubject(buildSubject(authnRequest,casAssertion,service));
    signAssertion(authnRequest,casAssertion,service);
    samlResponse.getAssertions().add(assertion);
  }
  final Status status=newStatus(StatusCode.SUCCESS,StatusCode.SUCCESS);
  samlResponse.setStatus(status);
  return samlResponse;
}
